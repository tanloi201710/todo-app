{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\nvar _Device = require('../Device');\n\nvar _Device2 = _interopRequireDefault(_Device);\n\nvar _logger = require('../logger');\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nvar logger = new _logger2.default('SSO.Google');\nvar default_options = {\n  google_client_id: null,\n  script: 'https://apis.google.com/js/platform.js',\n  scope: 'profile email openid'\n  /**\n  * Reference: https://developers.google.com/identity/sign-in/web/reference\n  */\n\n};\n\nvar Google = function () {\n  function Google(options) {\n    _classCallCheck(this, Google);\n\n    if (typeof options === 'string') {\n      options = {\n        google_client_id: options\n      };\n    }\n\n    this._options = Object.assign({}, default_options, options);\n\n    if (!this._options.google_client_id) {\n      logger.warn('missing google_client_id');\n    }\n\n    this.signIn = this.signIn.bind(this);\n    this.signOut = this.signOut.bind(this);\n    this.check = this.check.bind(this);\n    this.ready = this.ready.bind(this);\n    this._initGapi = this._initGapi.bind(this);\n    this._user = this._user.bind(this);\n    this._ga = null;\n\n    this._createScript();\n  }\n\n  _createClass(Google, [{\n    key: 'signIn',\n    value: function signIn() {\n      var _this = this;\n\n      if (!this._ga) {\n        return Promise.reject('no ga instance');\n      }\n\n      return this._ga.signIn().then(function (googleUser) {\n        return _this._user(googleUser);\n      });\n    }\n  }, {\n    key: 'signOut',\n    value: function signOut() {\n      if (!this._ga) {\n        return Promise.reject('no ga instance');\n      }\n\n      return this._ga.signOut();\n    }\n  }, {\n    key: 'check',\n    value: function check() {\n      var _this2 = this;\n\n      if (!this._ga) {\n        return Promise.reject('no ga instance');\n      }\n\n      return new Promise(function (resolve, reject) {\n        var googleUser = _this2._ga.currentUser.get();\n\n        if (!googleUser) {\n          reject('no google user');\n          return;\n        }\n\n        if (googleUser.isSignedIn()) {\n          resolve(_this2._user(googleUser));\n        } else {\n          reject('not signed in');\n        }\n      });\n    }\n  }, {\n    key: 'ready',\n    value: function ready() {\n      var google_client_id = this._options.google_client_id;\n\n      if (!google_client_id) {\n        return Promise.reject('missing google_client_id in options');\n      }\n\n      var that = this;\n      return new Promise(function (resolve, reject) {\n        var checkCount = 0;\n\n        var checkGA = function checkGA() {\n          checkCount++;\n\n          if (that._ga) {\n            resolve();\n            return;\n          }\n\n          if (window.gapi) {\n            that._initGapi();\n\n            return;\n          }\n\n          if (checkCount < 5) {\n            window.setTimeout(checkGA, 500);\n          } else {\n            reject('timeout');\n          }\n        };\n\n        checkGA();\n      });\n    }\n  }, {\n    key: '_user',\n    value: function _user(googleUser) {\n      var _googleUser$getAuthRe = googleUser.getAuthResponse(),\n          id_token = _googleUser$getAuthRe.id_token;\n\n      var profile = googleUser.getBasicProfile();\n      return {\n        id_token: id_token,\n        email: profile.getEmail(),\n        name: profile.getName()\n      };\n    }\n  }, {\n    key: '_createScript',\n    value: function _createScript() {\n      if (window.gapi) {\n        this._initGapi();\n\n        return;\n      }\n\n      var script = this._options.script;\n\n      if (script === 'none') {\n        return;\n      }\n\n      var src = this._options.script;\n\n      _Device2.default.createScript(src, true, this._initGapi);\n    }\n  }, {\n    key: '_initGapi',\n    value: function _initGapi() {\n      logger.debug('init gapi');\n      var _options = this._options,\n          google_client_id = _options.google_client_id,\n          scope = _options.scope;\n\n      if (!google_client_id) {\n        logger.warn('missing google_client_id in options');\n        return;\n      }\n\n      var that = this;\n      var g = window.gapi;\n      g.load('auth2', function () {\n        g.auth2.init({\n          client_id: google_client_id,\n          scope: scope\n        }).then(function (ga) {\n          that._ga = ga;\n        });\n      });\n    }\n  }]);\n\n  return Google;\n}();\n\nexports.default = Google;","map":{"version":3,"sources":["/home/tanloi/Documents/React/todo-app/node_modules/fsts/lib/sso/Google.js"],"names":["Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","_Device","require","_Device2","_interopRequireDefault","_logger","_logger2","obj","__esModule","default","_classCallCheck","instance","TypeError","logger","default_options","google_client_id","script","scope","Google","options","_options","assign","warn","signIn","bind","signOut","check","ready","_initGapi","_user","_ga","_createScript","_this","Promise","reject","then","googleUser","_this2","resolve","currentUser","get","isSignedIn","that","checkCount","checkGA","window","gapi","setTimeout","_googleUser$getAuthRe","getAuthResponse","id_token","profile","getBasicProfile","email","getEmail","name","getName","src","createScript","debug","g","load","auth2","init","client_id","ga"],"mappings":"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","sourcesContent":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _Device = require('../Device');\n\nvar _Device2 = _interopRequireDefault(_Device);\n\nvar _logger = require('../logger');\n\nvar _logger2 = _interopRequireDefault(_logger);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar logger = new _logger2.default('SSO.Google');\n\nvar default_options = {\n    google_client_id: null,\n    script: 'https://apis.google.com/js/platform.js',\n    scope: 'profile email openid'\n\n    /**\n    * Reference: https://developers.google.com/identity/sign-in/web/reference\n    */\n};\nvar Google = function () {\n    function Google(options) {\n        _classCallCheck(this, Google);\n\n        if (typeof options === 'string') {\n            options = { google_client_id: options };\n        }\n        this._options = Object.assign({}, default_options, options);\n        if (!this._options.google_client_id) {\n            logger.warn('missing google_client_id');\n        }\n\n        this.signIn = this.signIn.bind(this);\n        this.signOut = this.signOut.bind(this);\n        this.check = this.check.bind(this);\n        this.ready = this.ready.bind(this);\n\n        this._initGapi = this._initGapi.bind(this);\n        this._user = this._user.bind(this);\n\n        this._ga = null;\n\n        this._createScript();\n    }\n\n    _createClass(Google, [{\n        key: 'signIn',\n        value: function signIn() {\n            var _this = this;\n\n            if (!this._ga) {\n                return Promise.reject('no ga instance');\n            }\n\n            return this._ga.signIn().then(function (googleUser) {\n                return _this._user(googleUser);\n            });\n        }\n    }, {\n        key: 'signOut',\n        value: function signOut() {\n            if (!this._ga) {\n                return Promise.reject('no ga instance');\n            }\n\n            return this._ga.signOut();\n        }\n    }, {\n        key: 'check',\n        value: function check() {\n            var _this2 = this;\n\n            if (!this._ga) {\n                return Promise.reject('no ga instance');\n            }\n\n            return new Promise(function (resolve, reject) {\n                var googleUser = _this2._ga.currentUser.get();\n                if (!googleUser) {\n                    reject('no google user');\n                    return;\n                }\n                if (googleUser.isSignedIn()) {\n                    resolve(_this2._user(googleUser));\n                } else {\n                    reject('not signed in');\n                }\n            });\n        }\n    }, {\n        key: 'ready',\n        value: function ready() {\n            var google_client_id = this._options.google_client_id;\n\n            if (!google_client_id) {\n                return Promise.reject('missing google_client_id in options');\n            }\n\n            var that = this;\n            return new Promise(function (resolve, reject) {\n                var checkCount = 0;\n                var checkGA = function checkGA() {\n                    checkCount++;\n                    if (that._ga) {\n                        resolve();\n                        return;\n                    }\n\n                    if (window.gapi) {\n                        that._initGapi();\n                        return;\n                    }\n\n                    if (checkCount < 5) {\n                        window.setTimeout(checkGA, 500);\n                    } else {\n                        reject('timeout');\n                    }\n                };\n                checkGA();\n            });\n        }\n    }, {\n        key: '_user',\n        value: function _user(googleUser) {\n            var _googleUser$getAuthRe = googleUser.getAuthResponse(),\n                id_token = _googleUser$getAuthRe.id_token;\n\n            var profile = googleUser.getBasicProfile();\n            return {\n                id_token: id_token,\n                email: profile.getEmail(),\n                name: profile.getName()\n            };\n        }\n    }, {\n        key: '_createScript',\n        value: function _createScript() {\n            if (window.gapi) {\n                this._initGapi();\n                return;\n            }\n\n            var script = this._options.script;\n\n            if (script === 'none') {\n                return;\n            }\n\n            var src = this._options.script;\n            _Device2.default.createScript(src, true, this._initGapi);\n        }\n    }, {\n        key: '_initGapi',\n        value: function _initGapi() {\n            logger.debug('init gapi');\n            var _options = this._options,\n                google_client_id = _options.google_client_id,\n                scope = _options.scope;\n\n            if (!google_client_id) {\n                logger.warn('missing google_client_id in options');\n                return;\n            }\n\n            var that = this;\n            var g = window.gapi;\n            g.load('auth2', function () {\n                g.auth2.init({\n                    client_id: google_client_id,\n                    scope: scope\n                }).then(function (ga) {\n                    that._ga = ga;\n                });\n            });\n        }\n    }]);\n\n    return Google;\n}();\n\nexports.default = Google;"]},"metadata":{},"sourceType":"script"}